(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n(34),o=n(62),r=n(20),c=n(12),s=n(26),l=n(50),u=(n(83),n(65)),d=n.n(u),h=n(56),p=n(18),f=n(47),y="CONNECTION_STATUS_CHANGED",j="SIGN_IN",b="REFRESH",O="ENTITY_APPLY_EVENT",g="ENTITY_CLEAR_DB",m=(n.p,function(e){return{type:y,payload:{status:e}}}),v=(n(84),n(24)),N=n(14),x=new(function(){function e(){Object(N.a)(this,e),this.serviceDefinitions=[]}return Object(v.a)(e,[{key:"register",value:function(e,t,n){n=n||"nodef";var a=this.serviceDefinitions.findIndex((function(t){return t.name===e&&t.instanceName===n})),i={name:e,cnst:t,instanceName:n};return a<0?this.serviceDefinitions.push(i):this.serviceDefinitions[a]=i,i}},{key:"getService",value:function(e){var t=void 0,n=this.serviceDefinitions.filter((function(t){return t.name===e}));n.length>0&&(t=n[n.length-1].cnst(this));return t}}]),e}()),E=n(87),C={};C.from=E.from,C.isArray=function(e){return Array.isArray(e)},C.indexOfEx=function(e,t){if(C.isArray(e))for(var n=0;n<e.length;n++)if(t&&t(e[n]))return n;return-1},C.clean=function(e){for(var t in e)null!==e[t]&&void 0!==e[t]||delete e[t];return e};var I=C,S=(n(55),n(127)),T=new S.a;T.next(1);T.subscribe((function(e){}));var A=new S.a;var _={EntityAdded:"entityadded"},w={Names:_,EntityAdded:function(e){return{type:_.EntityAdded,payload:e}}},k=function e(){Object(N.a)(this,e)};k.publish=function(e){return A.next(e)},k.subscribe=function(e){return A.subscribe({next:function(t){return e(t)}})},k.Events=w,A.subscribe((function(e){if(e.type===_.EntityAdded&&e.payload&&"phonecall"===e.payload.type&&(new Date-new Date(e.payload.payload.time))/1e3<120){!function(){try{Notification.requestPermission().then()}catch(e){return!1}}();var t="Phone Call "+e.payload.payload.firstName+" "+e.payload.payload.lastName;new Notification("To do list",{body:t+="</hr><strong>xxxxx</strong>",icon:"/to-do-notifications/img/icon-128.png"})}}));var D=k;function P(e,t,n){return e[t]&&e[t][n]?e[t][n]:null}var G,F=function e(t,n){var a=this;if(Object(N.a)(this,e),this.state={},this.action={},this.getChannelId=function(){return a.action.payload.channelId},this.getChannel=function(){var e=P(a.state,"channel",a.getChannelId());if(!e){var t=a.getChannelId();e=e||{type:"channel",id:t,name:"new"}}return e},this.isValid=function(){return a.action&&a.action.payload&&a.action.payload.channelId},this.version=function(){return a.action.payload.version},this.payload1=function(){return a.action.payload||{}},this.payload2=function(){return a.payload1().payload||{}},this.payload3=function(){return a.payload2().payload||{}},this.isRemoveOperation=function(){return"remove"==a.payload2().action||a.payload2().removed},this.isRemoveOperation_dep=function(){return a.action&&a.action.payload&&a.action.payload.payload&&a.action.payload.payload.removed},this.getEntityId=function(){return a.action&&a.action.payload&&a.action.payload.payload?a.action.payload.payload.id:null},this.getEntityType=function(){return a.action&&a.action.payload&&a.action.payload.payload?a.action.payload.payload.type:null},this.getEntityName=function(){return a.action&&a.action.payload&&a.action.payload.payload?a.action.payload.payload.name:null},this.getEntity=function(){var e=a.getEntityId(),t=a.getEntityType();return e&&t?P(a.state,t,e):null},this.mergeAttributes=function(e){if(e=e||a.getEntity()){e.payload;var t=a.action&&a.action.payload&&a.action.payload.payload&&a.action.payload.payload.attributes||{};try{e.payload=Object.assign({},e.payload,t)}catch(n){}}},this.merge=function(e){if(!(e=e||a.getEntity())){var t=a.getEntityId(),n=a.getEntityType();t&&n&&(e={type:n,id:t,payload:{}})}if(e){var i=a.action&&a.action.payload&&a.action.payload.payload&&a.action.payload.payload.payload||{};e.payload=Object.assign({},e.payload,I.clean(i)),e.name=a.getEntityName()||e.name,e.description=a.payload2().description||e.description,e.channelId=a.getChannelId(),a.mergeAttributes(e)}return e},this.state=t||{},n&&n.payload&&n.payload.payload&&"string"===typeof n.payload.payload.payload)try{n.payload.payload.payload=JSON.parse(n.payload.payload.payload)}catch(i){}this.action=n||{}},R={tracker:function(e,t){var n=e.getEntity(),a=t(e),i=e.getEntity();return i&&!n&&D.publish(D.Events.EntityAdded(i)),a},updateFilter:function(e,t){var n=e.state,a=e.action,i=a.payload.channelId,o=e.getEntityId(),r=e.getEntityType(),s=e.getChannel()||{type:"channel",id:i,name:"new",version:0};a.payload&&Number.isInteger(a.payload.version)&&a.payload.version>-1&&(s.version=a.payload.version),s.children=s.children||[],s.messages=s.messages||[];var l=e.merge();if(l&&o&&r)switch(r){case"message":s.messages.includes(l.id)||s.messages.push(o);break;case"channel":l.id===i&&(s=Object.assign({},s,l));break;default:s.children.findIndex((function(e){return e&&e.id==o&&e.entityType==r}))>-1||s.children.push({type:r,id:o})}return s.id=i,l&&r&&o&&o!=i?(e.state=Object(c.a)(Object(c.a)({},n),{},Object(p.a)({channel:Object(c.a)(Object(c.a)({},n.channel),{},Object(p.a)({},i,s))},r,Object(c.a)(Object(c.a)({},n[r]),{},Object(p.a)({},o,l)))),console.info("Entity '"+r+"' successfully updated:",l)):s&&i?(e.state=Object(c.a)(Object(c.a)({},n),{},{channel:Object(c.a)(Object(c.a)({},n.channel),{},Object(p.a)({},i,s))}),console.info("Channel '"+i+"' successfully updated:",s)):console.error("Unexpected Error: Bad channel! Cannoy figure out the channel/entity for this action:",a),t(e)},removeFilter:function(e,t){if(e.isRemoveOperation()){var n=e.getEntityId(),a=e.getEntityType();if(n&&a){var i=e.state[a]||{};i[n]=null,e.state[a]=I.clean(i);var o=e.getChannel(),r=-1;if("message"===a)(r=o.messages.indexOf(n))>-1&&o.messages.splice(r,1);else for(r=o.children.findIndex((function(e){return e.id===n&&e.type===a}));r>-1;)o.children.splice(r,1),r=o.children.findIndex((function(e){return e.id===n&&e.type===a}));console.info("Entity '"+a+"' with id: ["+n+"] removed.")}}return t(e)},versionControlFilter:function(e,t){var n=e.getChannel().version,a=e.action.payload.version;if("number"===typeof a&&isFinite(a));var i=t(e),o=e.getChannel().version;return e.getChannel().status="",console.log("Version of "+e.getChannelId()+" Changed From",n," to",o),i},logFilter:function(e,t){var n=null;console.log("Pipeline Starts Channel:",e.getChannel(),"action:",e.action);try{n=t(e)}catch(a){console.error("An error occured in pipeline:",a)}return console.log("Pipeline Finish Channel:",e.getChannel(),"action:",e.action),n},validateFilter:function(e,t){e.action.payload;return e&&e.action&&e.action.payload&&e.action.payload.channelId&&e.action.payload.version?t(e):(console.warn("Invalid Event :",e.action),e.state)},createPipeLineContext:function(e,t){return new F(e,t)}};function L(e,t,n){return e[t]&&e[t][n]?e[t][n]:null}var H,U=function e(t,n,a){return(a=a||0)>=t.length?n.state:t[a](n,(function(n){return e(t,n,++a)}))},M=Object(f.createReducer)({channel:{}},(G={},Object(p.a)(G,O,(function(e,t){if(t.payload){var n=[];if(n.push(R.logFilter),n.push(R.tracker),n.push(R.validateFilter),n.push(R.versionControlFilter),n.push(R.updateFilter),n.push(R.removeFilter),"undefined"===typeof t.payload.length){var a=R.createPipeLineContext(e,t);return U(n,a),a.state}return t.payload.forEach((function(t){var a=R.createPipeLineContext(e,{type:O,payload:t});U(n,a),e=a.state})),e}})),Object(p.a)(G,g,(function(e,t){return{}})),G)),Y=function(e,t){var n=[],a=e.entities[t]||{};for(var i in a)n.push(a[i]);return n},B=function(e){return Y(e,"channel")},V=function(e,t){var n=(L(e.entities,"channel",t)||{}).messages||[],a=[];return n.map((function(t){return a.push(L(e.entities,"message",t)||{})})),a},J={ENTITY_APPLY_EVENT:"ENTITY_APPLY_EVENT",SEND_MESSAGE_TO_CHANNEL:"SEND_MESSAGE_TO_CHANNEL",CONNECTION_CLOSED:"CONNECTION_CLOSED",CONNECTION_STATUS_CHANGED:"CONNECTION_STATUS_CHANGED",CONNECTION_STATUS_CONNECTED:"CONNECTION_STATUS_CONNECTED",CONNECTION_STATUS_DISCONNECTED:"CONNECTION_STATUS_DISCONNECTED",SIGN_OUT:"SIGN_OUT",SIGN_IN:"SIGN_IN",SIGNED_IN:"SIGNED_IN",REFRESH:"REFRESH",FORGET:"FORGET"},z=J,W=function(e){return{type:J.ENTITY_APPLY_EVENT,payload:e}},q=function(e,t){return{type:J.SEND_MESSAGE_TO_CHANNEL,payload:{text:t,channelId:e}}},X=Object(f.createReducer)({chatState:"NOT_CHATTING",widgetState:"MAXIMIZED",chatService:"botEngine",rate:"none",activeChatId:0,connectionState:"close",token:""},(H={},Object(p.a)(H,J.SIGNED_IN,(function(e,t){var n=t.payload;return Object(c.a)(Object(c.a)({},e),{},{token:n.token,userName:n.userName,loggedIn:!0})})),Object(p.a)(H,J.SIGN_OUT,(function(e,t){t.payload;return Object(c.a)(Object(c.a)({},e),{},{loggedIn:!1})})),Object(p.a)(H,J.CONNECTION_STATUS_CHANGED,(function(e,t){var n=t.payload;return console.info("connection status changed",n),Object(c.a)(Object(c.a)({},e),{},{connectionState:n.status})})),H)),Z=function(e){return e.app.loggedIn},K=function(e){return e.app.userName},Q=n(54),$={},ee=function e(){Object(N.a)(this,e)};ee.serverUrl="http://172.16.6.158:5000/chatHub";var te=ee,ne={types:{channel:"channel",phonecall:"phonecall"},serviceNames:{storeAPI:"storeAPI"}},ae=(new Q.b).configureLogging(Q.c.Information).withAutomaticReconnect({nextRetryDelayInMilliseconds:function(e){return e.elapsedMilliseconds<6e4?5e3*Math.random():e.previousRetryCount<100?1e5*Math.random():null}}).withUrl(te.serverUrl,{skipNegotiation:!0,transport:Q.a.WebSockets}).build(),ie=function(e){var t=e.getState();if(t._persist&&t._persist.rehydrated){var n={channels:[]};B(t).forEach((function(e){console.debug("StartModel:",e,"State=",t),n.channels.push({id:e.id,version:e.version})})),console.info("******************connected*************");var a=function(e){return e.app.token}(e.getState());ae.invoke("Authorize",a,n).then((function(e){console.info("Connection Successfully Authroized")})).catch((function(e){console.error("Authorization Failed")}))}else console.error("rehydration!!!")},oe=function(e){return $.storeAPI=e,x.register(ne.serviceNames,(function(t){return e})),ae.on("apply",(function(t){return function(e,t){console.info("processApplyEvent  ",t),null!=t&&(t.length||(t=[t]),e.dispatch(W(t)))}(e,t)})),ae.onclose((function(t){return e.dispatch(m("close"))})),ae.onreconnected((function(t){return e.dispatch(m("reconnected"))})),ae.onreconnecting((function(t){e.dispatch(m("reconnection"))})),ae.start().then((function(t){setTimeout((function(){e.dispatch(m("connected"))}),500)})).catch((function(e){console.error("Error on start...")})),function(t){return function(n){n.type==j&&(console.debug("sign in ",n.payload),ae.invoke("signIn",n.payload).then((function(t){console.debug("Successfully signed in. payload: ",t),e.dispatch({type:"SIGNED_IN",payload:t}),e.dispatch({type:g,payload:{}}),ie(e)})).catch((function(e){console.error("an error occured whilte tringto signIn: "+e)}))),n.type==b&&(console.debug("Invoking refresh..."),ae.invoke("refersh",n.payload).then((function(e){console.debug("Successfully refershed in. payload: ",e)})).catch((function(e){console.error("an error occured whilte tringto signIn: "+e)}))),n.type===z.SEND_MESSAGE_TO_CHANNEL&&(console.log("sending to server",n),ae.invoke("execute",JSON.stringify(n)));var a=t(n);return n.type==y&&(!n.payload||"connected"!==n.payload.status&&"reconnected"!==n.payload.status||(console.info("Reconnected to server. We will apply start."),ie(e))),console.log("signalr next state",e.getState()),a}}},re={key:"root",storage:d.a},ce=Object(l.a)(re,{app:X,entities:M}),se=Object(h.a)(),le=function(e){var t=Object(s.d)(Object(s.a)(oe),window.devToolsExtension?window.devToolsExtension():function(e){return e})(s.e),n=Object(c.a)(Object(c.a)({},t(ce)),{},{runSaga:se.run});return{persistor:Object(l.b)(n),store:n}},ue=n(22),de=n(4),he=function(e){return Object(de.jsx)("div",{children:e.items.map((function(e,t){return Object(de.jsxs)("p",{children:[Object(de.jsx)(ue.b,{to:"./"+e.id,children:e.id}),e.version,"  ",(e.payload||{}).name]},t)}))})},pe=Object(r.b)((function(e){return{items:B(e)}}),(function(e){return{}}))(he),fe=n(68);Array.prototype.mapEx=function(e){return this.map((function(t,n){return t.message=t.payload.Message,e(t,n)}))};var ye=function(e){var t=Object(a.useState)("kk"),n=Object(fe.a)(t,2),i=n[0],o=n[1];return Object(de.jsxs)("div",{children:[Object(de.jsxs)("div",{children:[e.name," "]}),Object(de.jsxs)("div",{children:[Object(de.jsx)("input",{placeholder:"Type message here",value:i,onChange:function(e){return o(e.target.value)}}),Object(de.jsx)("button",{onClick:function(t){return e.sendMessageToChannel(i,e.channelId)},children:"Send"}),Object(de.jsx)(ue.b,{to:"home",children:"Home"})]}),Object(de.jsx)("div",{children:e.items.mapEx((function(e,t){return Object(de.jsxs)("p",{children:[e.id," ",e.version," ",e.payload.message," by: "]},e.id)}))})]})};var je=Object(r.b)((function(e){var t=function(e,t,n){return L(e.entities,t,n)}(e,"channel",window.location.pathname.replace("/",""))||{id:"",payload:{}};return t.payload=t.payload||{},{items:V(e,t.id),name:t.payload.name,channelId:t.id}}),(function(e){return{sendMessageToChannel:function(t,n){e(q(n,t))}}}))(ye),be=n(43),Oe=n(52),ge=n(51),me=(n(95),function(e){Object(Oe.a)(n,e);var t=Object(ge.a)(n);function n(e){var a;return Object(N.a)(this,n),(a=t.call(this,e)).state={username:"",password:"",submitted:!1},a.handleSubmit=a.handleSubmit.bind(Object(be.a)(a)),a.handleChange=a.handleChange.bind(Object(be.a)(a)),a}return Object(v.a)(n,[{key:"handleChange",value:function(e){var t=e.target,n=t.name,a=t.value;this.setState(Object(p.a)({},n,a))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state,n=t.username,a=t.password;n&&a&&this.props.signIn(n,a)}},{key:"render",value:function(){this.props.loggingIn;var e=this.state,t=e.username,n=e.password;e.submitted;return Object(de.jsx)("div",{className:"d-flex justify-content-center align-items-center vh-100",children:Object(de.jsxs)("form",{children:[Object(de.jsx)("div",{style:{minHeight:"100px"}}),Object(de.jsx)("h3",{children:"Sign In"}),Object(de.jsxs)("div",{className:"form-group",children:[Object(de.jsx)("label",{children:"Email address"}),Object(de.jsx)("input",{type:"email",className:"form-control",name:"username",value:t,onChange:this.handleChange,placeholder:"Enter email"})]}),Object(de.jsxs)("div",{className:"form-group",children:[Object(de.jsx)("label",{children:"Password"}),Object(de.jsx)("input",{type:"password",className:"form-control",name:"password",value:n,onChange:this.handleChange,placeholder:"Enter password"})]}),Object(de.jsx)("div",{className:"form-group",children:Object(de.jsxs)("div",{className:"custom-control custom-checkbox",children:[Object(de.jsx)("input",{type:"checkbox",className:"custom-control-input",id:"customCheck1"}),Object(de.jsx)("label",{className:"custom-control-label",htmlFor:"customCheck1",children:"Remember me"})]})}),Object(de.jsx)("button",{className:"btn btn-primary btn-block",onClick:this.handleSubmit,children:"Submit"}),Object(de.jsxs)("p",{className:"forgot-password text-right",children:["Forgot ",Object(de.jsx)("a",{href:"#",children:"password?"})]})]})})}}]),n}(a.Component)),ve=Object(r.b)((function(e){return{messages:""}}),(function(e){return{signIn:function(t,n){e(function(e,t){return{type:j,payload:{userName:e,password:t}}}(t,n)),setTimeout((function(){window.location="/"}),2e3)}}}))(me),Ne=Object(r.b)((function(e){return{singnedIn:Z(e)}}))((function(e){return Object(de.jsxs)("div",{children:[Object(de.jsx)("h1",{children:"App "}),Object(de.jsx)("h2",{children:"Sample App:  "}),Object(de.jsx)("p",{children:":"}),Object(de.jsxs)("ul",{children:[Object(de.jsxs)("li",{children:[" Charters:  ",Object(de.jsx)("a",{href:"/charters",children:"Charters "}),"."]}),Object(de.jsxs)("li",{children:["   ",Object(de.jsx)(ue.b,{to:"/logs",children:"Logs "})]}),Object(de.jsxs)("li",{children:["   ",Object(de.jsx)(ue.b,{to:"/phonecalls",children:"Phone Calls "})]}),Object(de.jsxs)("li",{children:["   ",Object(de.jsx)(ue.b,{to:"/channels",children:"Channels "})]})]})]})})),xe=function(e){return Object(de.jsx)("div",{children:"Logs"})},Ee=function(e){Object(Oe.a)(n,e);var t=Object(ge.a)(n);function n(e){return Object(N.a)(this,n),t.call(this,e)}return Object(v.a)(n,[{key:"time",get:function(){return this.data.payload.time||this.data.payload.Time}}]),n}(function(){function e(t){Object(N.a)(this,e),this.data={},this.data=t||{}}return Object(v.a)(e,[{key:"payload",get:function(){return this.data.payload||{}}},{key:"toString",value:function(){return JSON.stringify(this.payload)}}]),e}()),Ce=function(){function e(t){Object(N.a)(this,e),this.state={},this.state=t}return Object(v.a)(e,[{key:"getPhoneCalls",value:function(e,t){e=e||0,t=t||1e3;var n=Y(this.state,"phonecall");return I.from(n).select((function(e){return new Ee(e)})).orderByDescending((function(e){return e.time})).skip(e*t).take(t)}}],[{key:"Create",value:function(t){return new e(t)}}]),e}(),Ie=function(e){return Object(de.jsxs)("div",{children:[Object(de.jsx)("h1",{children:"Phone Calls"}),Object(de.jsx)("ul",{children:e.calls.map((function(e,t){return function(e,t){return Object(de.jsxs)("li",{children:[t," [",e.time,"] ",Object(de.jsxs)("strong",{children:[e.toString()," "]}),": ",e.name]},t)}(e,t)}))})]})},Se=Object(r.b)((function(e){return{calls:Ce.Create(e).getPhoneCalls().toArray()}}),(function(e){return{}}))(Ie),Te=n(10),Ae=n(121),_e=n(128),we=n(123),ke=n(125),De=n(126),Pe=n(124),Ge=n(67),Fe=n.n(Ge),Re=Object(Ae.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));var Le=Object(r.b)((function(e){return{singnedIn:Z(e),userName:K(e)}}))((function(e){var t=Re();return Object(de.jsxs)("div",{className:t.root,children:[Object(de.jsx)(_e.a,{position:"static",children:Object(de.jsxs)(we.a,{children:[Object(de.jsx)(Pe.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",children:Object(de.jsx)(Fe.a,{})}),Object(de.jsx)(ue.b,{to:"home",children:"Home"}),Object(de.jsx)(ke.a,{variant:"h6",className:t.title,children:e.userName}),Object(de.jsx)(De.a,{color:"inherit",href:"Signin",children:"Login "}),Object(de.jsx)(ue.b,{to:"SignIn",children:"SinIn"})]})}),e.children]})})),He=function(){function e(){Object(N.a)(this,e)}return Object(v.a)(e,null,[{key:"TT",value:function(){}},{key:"storeAPI",value:function(){return x.getService(ne.serviceNames.storeAPI)}}]),e}();He.config=te,He.constants=ne,He.configureStore=le;var Ue=He,Me=function(){},Ye=Ue.constants.serviceNames;(function(){x.register("AService",(function(e){return new Me})),x.register(Ye.storeAPI,(function(e){return null}),"instance")})();var Be=Ue.configureStore(),Ve=Be.store,Je=Be.persistor,ze=document.getElementById("root"),We={get:function(e){return window.location.pathname}};Object(i.render)(Object(de.jsx)(r.a,{store:Ve,children:Object(de.jsx)(o.PersistGate,{persistor:Je,children:Object(de.jsx)(ue.a,{children:Object(de.jsx)(Le,{children:Object(de.jsxs)(Te.c,{children:[Object(de.jsx)(Te.a,{exact:!0,path:"/home",children:Object(de.jsx)(Ne,{})}),Object(de.jsx)(Te.a,{path:"/SignIn",children:Object(de.jsx)(ve,{})}),Object(de.jsx)(Te.a,{path:"/Logs",children:Object(de.jsx)(xe,{})}),Object(de.jsx)(Te.a,{path:"/PhoneCalls",children:Object(de.jsx)(Se,{})}),Object(de.jsx)(Te.a,{path:"/channels",children:Object(de.jsx)(pe,{})}),Object(de.jsx)(Te.a,{path:"/:id",children:Object(de.jsx)(je,{id:We.get("id")})}),Object(de.jsx)(Te.a,{children:Object(de.jsx)(Ne,{})})]})})})})}),ze)},95:function(e,t,n){}},[[100,1,2]]]);
//# sourceMappingURL=main.07c37071.chunk.js.map